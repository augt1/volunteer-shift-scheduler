 <!-- Locations grid -->
{% load shift_tags %}
<div id="grid-container" class="flex gap-4">
    {% for location in locations %}
    <div class="bg-white rounded-lg shadow overflow-hidden w-64 flex-none">
        <div class="sticky top-0 text-center p-4 bg-gray-50 border-b h-[72px] z-10">
            <div class="font-bold">{{ location.name }}</div>
        </div>
        
        <div class="grid grid-cols-1 relative" style="grid-template-rows: repeat({{ hour_slots|length }}, minmax(3rem, auto));">
            {% for hour in hour_slots %}
            <div class="{% if hour.hour < 5 %}bg-gray-50{% endif %} border-b border-gray-100 h-12 cursor-pointer hover:bg-gray-50 transition-colors duration-150"
                 @click="modalOpen = true"
                 hx-get="{% url 'add_shift_modal' %}"
                 hx-target="#modal-container"
                 hx-trigger="click"
                 hx-vals='{"date": "{{ current_date|date:'Y-m-d' }}", "time": "{{ hour|time:'H:i' }}", "event": "{{ current_event.id }}", "location": "{{ location.id }}"}'>
            </div>
            {% endfor %}
            
            <!-- Shifts as absolute positioned elements -->
            {% with location_shifts=shifts_by_location|get_item:location %}
            {% for hour_str, shifts in location_shifts.items %}
            {% for shift in shifts %}
            <div class="absolute px-1"
                 style="top: calc({{ shift.grid_row_start|add:"-1" }} * 3rem);
                        height: calc({{ shift.grid_row_span }} * 3rem - 2px);
                        {% if shift.total_columns %}
                        left: calc({{ shift.column }} * (100% / {{ shift.total_columns }}));
                        width: calc(100% / {{ shift.total_columns }});
                        {% else %}
                        left: 0;
                        right: 0;
                        {% endif %}">
                <div class="h-full p-2 rounded text-sm hover:bg-opacity-75 transition-colors duration-150
                          bg-{{ shift.position.color }}-100 border-{{ shift.position.color }}-200 border">
                    <div class="flex justify-between">
                        <a href="#" 
                           @click.prevent="modalOpen = true"
                           hx-get="{% url 'edit_shift_modal' shift.id %}"
                           hx-target="#modal-container"
                           hx-trigger="click"
                           class="flex-1">
                            <div class="font-medium text-{{ shift.position.color }}-900 truncate">
                                {{ shift.position.name }}
                            </div>
                            <div class="text-xs text-{{ shift.position.color }}-800">
                                {{ shift.start_time|time:"H:i" }} - {{ shift.end_time|time:"H:i" }}
                            </div>
                        </a>
                    </div>
                    <div class="flex justify-between items-center mt-1">
                        <div class="text-xs text-{{ shift.position.color }}-700">
                            {{ shift.volunteers.count }}/{{ shift.max_volunteers }}
                        </div>
                        <button type="button"
                                hx-get="{% url 'assign_volunteers_modal' shift.id %}"
                                hx-target="#modal-container"
                                hx-swap="innerHTML"
                                hx-trigger="click"
                                @htmx:before-request="modalOpen = true"
                                class="px-2 py-0.5 text-xs bg-{{ shift.position.color }}-400 text-{{ shift.position.color }}-900 hover:bg-{{ shift.position.color }}-500 rounded">
                            Assign
                        </button>
                    </div>
                    <!-- Display volunteers assigned to this shift -->
                    {% if shift.volunteers.all %}
                    <div class="mt-1 pt-1 border-t border-{{ shift.position.color }}-200">
                        <div class="text-xs text-{{ shift.position.color }}-800 font-medium">Volunteers:</div>
                        <ul class="text-xs text-{{ shift.position.color }}-700 mt-0.5 max-h-20 overflow-y-auto">
                            {% for volunteer in shift.volunteers.all %}
                            <li class="truncate">{{ volunteer.get_full_name }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
            {% endfor %}
            {% endwith %}
        </div>
    </div>
    {% endfor %}
</div>
